<html>
    <head>
        <script
            src='https://code.responsivevoice.org/responsivevoice.js'>
         </script>
        <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
        <script src='/socket.io/socket.io.js'></script>
        <script>

         var fnSpeak = function(example){
             var speaker = "US English Male";
             responsiveVoice.speak(example, speaker);
         };

         var socket = io.connect('http://localhost:8080');
         socket.emit('register', {});
         socket.on('onReadExamples', function(jsonData){
             var date = jsonData.date;
             var examples = jsonData.data;

             $('#id_date').text(date);
             $('#id_examples').empty();

             for (var i in examples)
             {
                 var example = examples[i].example;
                 var word = examples[i].word;
                 var sentence = example.replace(
                     word,
                     $('<strong/>').text(word).prop('outerHTML'));

                 var $input = $('<input/>',
                                {type: 'button', value: 'sound'});
                 $input.click(fnSpeak.bind(this, example));

                 $('#id_examples').append(
                     $('<li/>')
                         .append(sentence)
                         .append($input)
                         );
             }

             var fnPlayNextSentence = function(e, currIdx){
                 if (!(currIdx in e)){
                     $('#id_play_all').prop('value', 'Play ALL');
                     return;
                 }

                 var sentence = e[currIdx].example;
                 var word = e[currIdx].word;
                 var speaker = "US English Male";
                 var fnNextPlay = fnPlayNextSentence.bind(this,
                                                          e, currIdx+1);
                 responsiveVoice.speak(sentence, speaker,
                                       {onend:fnNextPlay});
                 $('#id_play_all').prop('value', 'Playing ' + word);
             }

              $('#id_play_all').click(function(){
                  fnPlayNextSentence(examples, 0);
              });
         });
        </script>
    </head>

    <body>
        <h3 id="id_date"> date </h3>
        <ul id="id_examples">
        </ul>
        <input id='id_play_all' type='button' value='Play ALL'/>
        <p id="id_log"/>
    </body>

</html>
